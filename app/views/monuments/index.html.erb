<% provide(:title, 'Monumenti nelle vicinanze') %>
<h1 class="title is-2 is-danger">Lista monumenti nelle vicinanze</h1>
<% if @monument.any? %>
<div id="mapid" class="is-centered" style="height: 300px;width:100%;"></div>
<script>
var mymap = L.map('mapid').setView(<%= @geocenter.to_s %>, 12);
L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v9/tiles/{z}/{x}/{y}?access_token=<%= ENV['MAPBOX_KEY'] %>', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(mymap);
<%= dummyfile = '' %>
<% @monument_nopagy.each do |monument| %>
L.marker([<%= monument.latitude %>, <%= monument.longitude %>]).addTo(mymap)
    .bindPopup('<%= image_tag "https://commons.wikimedia.org/w/thumb.php?f=#{monument.image}&w=400" unless monument.image.blank? %><br/> <%= link_to monument.itemLabel.capitalize, show_path(id: monument.id) %>');
    
<% end %>
var redIcon = new L.Icon({
  iconUrl: '<%= image_url 'marker-icon-2x-green.png' if monument.with_photos %> <%= image_url 'marker-icon-2x-red.png' unless monument.with_photos%>',
  shadowUrl: '<%= image_url 'marker-shadow.png' %>',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

L.marker(<%= @geocenter.to_s %>, {icon: redIcon}).bindPopup('Tu sei qui').addTo(mymap);

</script>
<table class="table">
  <thead>
    <th>Immagine</th>
    <th>Nome</th>
    <th>Link</th>
  </thead>
  <tbody>
      <% @monument.each do |monument| %>
      <tr>
        <td>
        <% if !monument.image.nil? %>
          <%= image_tag "https://commons.wikimedia.org/w/thumb.php?f=#{monument.image}&w=200" , width: 200  %>
        <% else %>
          <%= link_to 'Scattane una tu!',"https://commons.wikimedia.org/w/index.php?title=Special:UploadWizard&campaign=wlm-it&id=#{monument.wlmid}&uselang=it&descriptionlang=it&lat=#{monument.latitude}&lon=#{monument.longitude}&categories=Images+from+Wiki+Loves+Monuments+#{DateTime.now.strftime('%y')}+in+Italy" %>
        <% end %>
        </td>
        <td>
        <%= monument.itemLabel %>
        </td>
        <td>
          <i class="fas fa-search"></i> <%= link_to 'Maggiori informazioni', show_path(id: monument.id), class: 'button is-link'%>
        </td>
      <% end %>
    </tbody>
</table>
  <%== pagy_bulma_nav_js(@pagy) %>
<% else %>
<h1 class="is-centered title is-3 is-red">Nessun monumento trovato nella località indicata</h1>
<% end %>
<% if @monument.nil? %>
<h1 class="is-centered title is-3 is-red">Nessun monumento trovato nella località indicata o errore</h1>
<% end %>
